---
phase: 01-plugin-foundation
plan: 03
type: execute
wave: 3
depends_on:
  - 01-02
files_modified: []
autonomous: false
requirements:
  - PLAT-02
  - PLAT-03

must_haves:
  truths:
    - "Plugin passes pluginval at basic strictness (level 5, fallback to level 3)"
    - "Plugin passes clap-validator without critical errors"
    - "VST3 format loads in Bitwig Studio 5+ without errors"
    - "CLAP format loads in Bitwig Studio 5+ without errors"
  artifacts: []
  key_links:
    - from: "~/.vst3/ChordPumper.vst3"
      to: "pluginval"
      via: "pluginval --strictness-level 5 --validate"
      pattern: "pluginval.*validate"
    - from: "~/.clap/ChordPumper.clap"
      to: "clap-validator"
      via: "clap-validator validate"
      pattern: "clap-validator.*validate"
    - from: "~/.vst3/ChordPumper.vst3"
      to: "Bitwig Studio"
      via: "Bitwig VST3 scan path (~/.vst3/)"
      pattern: "\\.vst3"
    - from: "~/.clap/ChordPumper.clap"
      to: "Bitwig Studio"
      via: "Bitwig CLAP scan path (~/.clap/)"
      pattern: "\\.clap"
---

<objective>
Validate the built plugin with automated tools (pluginval for VST3, clap-validator for CLAP) and confirm both formats load correctly in Bitwig Studio. This plan proves Phase 1 success criteria are met.

Purpose: Automated validation catches format compliance issues; Bitwig loading confirms real-world host compatibility.
Output: Validation results confirming all formats work. Phase 1 complete.
</objective>

<execution_context>
@~/.cursor/get-shit-done/workflows/execute-plan.md
@~/.cursor/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-plugin-foundation/01-RESEARCH.md
@.planning/phases/01-plugin-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Automated plugin validation</name>
  <files></files>
  <action>
Install validation tools if not already present, then run them against the built plugin.

**pluginval (VST3 validation):**

1. Check if pluginval is installed: `which pluginval`
2. If not installed, download the latest Linux binary from GitHub releases:
   ```
   curl -L -o /tmp/pluginval.zip https://github.com/Tracktion/pluginval/releases/latest/download/pluginval_Linux.zip
   cd /tmp && unzip -o pluginval.zip && chmod +x pluginval
   sudo mv pluginval /usr/local/bin/
   ```
   If curl/download fails (network restrictions), skip pluginval and note it as a manual follow-up.

3. Run pluginval at strictness level 5:
   ```
   pluginval --strictness-level 5 --validate ~/.vst3/ChordPumper.vst3
   ```
4. If level 5 fails, retry at level 3 (acceptable for Phase 1 shell with no parameters):
   ```
   pluginval --strictness-level 3 --validate ~/.vst3/ChordPumper.vst3
   ```
5. Record the strictness level that passed and any warnings.

**clap-validator (CLAP validation):**

1. Check if clap-validator is installed: `which clap-validator`
2. If not installed, try cargo install:
   ```
   cargo install --git https://github.com/free-audio/clap-validator
   ```
   If cargo is not available or install fails, try AUR: `paru -S clap-validator` or skip and note as manual follow-up.

3. Run clap-validator:
   ```
   clap-validator validate ~/.clap/ChordPumper.clap
   ```
4. Record results. Warnings are acceptable; errors need investigation.

**Standalone smoke test:**

Launch standalone with a short timeout to verify it starts without crashing:
```
timeout 5 ./build/debug/ChordPumper_artefacts/Standalone/ChordPumper &
sleep 2
# Check if process is still running (didn't crash on startup)
pgrep -f "ChordPumper" && echo "STANDALONE_OK" || echo "STANDALONE_FAILED"
kill %1 2>/dev/null || true
```
  </action>
  <verify>
pluginval output shows "ALL TESTS PASSED" or similar success message.
clap-validator output shows no critical errors.
Standalone process starts without immediate crash.
  </verify>
  <done>VST3 passes pluginval validation. CLAP passes clap-validator. Standalone launches without crashing. Validation strictness level and any warnings documented.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Bitwig Studio host loading verification</name>
  <what-built>ChordPumper plugin (VST3 + CLAP) installed to standard Linux paths and validated with automated tools. All three format binaries exist: VST3 at ~/.vst3/ChordPumper.vst3, CLAP at ~/.clap/ChordPumper.clap, Standalone at build/debug/ChordPumper_artefacts/Standalone/ChordPumper.</what-built>
  <how-to-verify>
1. Open Bitwig Studio
2. Go to Settings → Plug-ins → click "Rescan" (or restart Bitwig if it was already running)
3. In the browser, search for "ChordPumper"
4. Verify it appears under **Instruments** (not Effects or MIDI Effects) for BOTH:
   - VST3 format
   - CLAP format
5. Load ChordPumper VST3 on an instrument track:
   - Confirm it loads without errors or warnings in the Bitwig console
   - Confirm plugin window opens showing a 1000x600 dark-themed window
   - Confirm "ChordPumper v0.1.0" text is centered in the window
   - Close the plugin window (no crash)
6. Load ChordPumper CLAP on a separate instrument track:
   - Same checks as VST3
7. (Optional) Launch standalone from terminal:
   ```
   ./build/debug/ChordPumper_artefacts/Standalone/ChordPumper
   ```
   - Confirm same dark window with centered text appears
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues (e.g., "CLAP not found", "window wrong size", "crash on close")</resume-signal>
</task>

</tasks>

<verification>
1. pluginval passes at level 5 (or level 3 with documented reason)
2. clap-validator passes without critical errors
3. User confirms both VST3 and CLAP appear as Instruments in Bitwig
4. User confirms plugin loads and shows correct dark-themed window
5. User confirms no crash on window close
</verification>

<success_criteria>
- VST3 passes pluginval at strictness level 3+
- CLAP passes clap-validator
- Both formats load in Bitwig Studio as Instruments
- Plugin window is 1000x600, dark theme, centered "ChordPumper v0.1.0" text
- No crashes on load or close in any format
- Phase 1 success criteria fully met:
  1. Plugin loads in Bitwig Studio as both VST3 and CLAP without errors ✓
  2. Standalone application launches and displays a window on CachyOS ✓
  3. CMake build with Ninja produces all three plugin formats ✓
  4. Plugin passes pluginval at basic strictness ✓
</success_criteria>

<output>
After completion, create `.planning/phases/01-plugin-foundation/01-03-SUMMARY.md`
</output>
