---
phase: 01-plugin-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .gitignore
  - .gitmodules
  - CMakeLists.txt
  - CMakePresets.json
  - VERSION
autonomous: true
requirements:
  - PLAT-01
  - PLAT-05

must_haves:
  truths:
    - "CMake configures successfully with Ninja generator on Linux x86_64"
    - "JUCE 8.0.12 and clap-juce-extensions submodules are present and recursive"
    - "cmake --preset debug completes without errors"
  artifacts:
    - path: "CMakeLists.txt"
      provides: "Build system with juce_add_plugin and clap_juce_extensions_plugin"
      contains: "juce_add_plugin"
    - path: "CMakePresets.json"
      provides: "Debug and Release build presets with Ninja"
      contains: "Ninja"
    - path: "libs/JUCE/CMakeLists.txt"
      provides: "JUCE 8.0.12 framework"
    - path: "libs/clap-juce-extensions/CMakeLists.txt"
      provides: "CLAP format support"
    - path: ".gitignore"
      provides: "Standard ignore patterns for C++/CMake/JUCE project"
    - path: "VERSION"
      provides: "Single source of truth for project version"
  key_links:
    - from: "CMakeLists.txt"
      to: "libs/JUCE"
      via: "add_subdirectory(libs/JUCE)"
      pattern: "add_subdirectory.*libs/JUCE"
    - from: "CMakeLists.txt"
      to: "libs/clap-juce-extensions"
      via: "add_subdirectory(libs/clap-juce-extensions EXCLUDE_FROM_ALL)"
      pattern: "add_subdirectory.*clap-juce-extensions.*EXCLUDE_FROM_ALL"
    - from: "CMakeLists.txt"
      to: "juce_add_plugin"
      via: "Plugin target declaration with IS_SYNTH TRUE"
      pattern: "IS_SYNTH\\s+TRUE"
---

<objective>
Set up the ChordPumper repository with git submodules (JUCE 8.0.12, clap-juce-extensions), CMake build configuration, and project scaffolding. After this plan, `cmake --preset debug` configures successfully.

Purpose: Establish the build foundation that all subsequent plans depend on — no source code yet, just the infrastructure to compile it.
Output: Configured CMake project with Ninja, ready for source files.
</objective>

<execution_context>
@~/.cursor/get-shit-done/workflows/execute-plan.md
@~/.cursor/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-plugin-foundation/01-RESEARCH.md
@.planning/phases/01-plugin-foundation/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Repository initialization and git submodules</name>
  <files>.gitignore, .gitmodules, VERSION</files>
  <action>
The git repo already exists on the master branch. Add submodules and config files:

1. Add JUCE as a git submodule:
   ```
   git submodule add -b master https://github.com/juce-framework/JUCE.git libs/JUCE
   cd libs/JUCE && git checkout 8.0.12 && cd ../..
   ```

2. Add clap-juce-extensions as a git submodule:
   ```
   git submodule add -b main https://github.com/free-audio/clap-juce-extensions.git libs/clap-juce-extensions
   cd libs/clap-juce-extensions && git checkout 02f91b7 && cd ../..
   ```

3. Initialize all recursive submodules (clap-juce-extensions has its own: clap, clap-helpers):
   ```
   git submodule update --init --recursive
   ```

4. Create VERSION file containing just: `0.1.0`

5. Create .gitignore with these patterns:
   - build/, Builds/, cmake-build-*/ (build output)
   - CMakeLists.txt.user, CMakeCache.txt, CMakeFiles/, cmake_install.cmake, _deps/ (CMake generated)
   - compile_commands.json (symlinked from build dir)
   - .idea/, .vscode/, *.swp, *~ (IDE)
   - .DS_Store, Thumbs.db (OS)
   - Testing/ (test artifacts)
  </action>
  <verify>
Run: `ls libs/JUCE/CMakeLists.txt libs/clap-juce-extensions/CMakeLists.txt` — both must exist.
Run: `cd libs/JUCE && git describe --tags` — must show 8.0.12 or similar.
Run: `ls libs/clap-juce-extensions/clap-libs/clap/` — must exist (proves recursive init worked).
Run: `cat VERSION` — must show 0.1.0.
  </verify>
  <done>JUCE 8.0.12 and clap-juce-extensions (commit 02f91b7) submodules present with all recursive dependencies. VERSION and .gitignore created.</done>
</task>

<task type="auto">
  <name>Task 2: CMake build configuration</name>
  <files>CMakeLists.txt, CMakePresets.json</files>
  <action>
Create CMakeLists.txt at project root with the following structure (reference 01-RESEARCH.md "Complete CMakeLists.txt for Phase 1" section):

- `cmake_minimum_required(VERSION 3.22)`
- `project(ChordPumper VERSION 0.1.0 LANGUAGES CXX)` — hardcode version for Phase 1 simplicity
- `set(CMAKE_CXX_STANDARD 20)`, `CMAKE_CXX_STANDARD_REQUIRED ON`, `CMAKE_EXPORT_COMPILE_COMMANDS ON`
- ccache detection: `find_program(CCACHE ccache)` and set as CXX_COMPILER_LAUNCHER if found
- `add_subdirectory(libs/JUCE)`
- `add_subdirectory(libs/clap-juce-extensions EXCLUDE_FROM_ALL)` — EXCLUDE_FROM_ALL prevents CJE test targets from polluting build
- `juce_add_plugin(ChordPumper ...)` with these exact flags:
  - COMPANY_NAME "ChordPumperDev"
  - PLUGIN_MANUFACTURER_CODE Cpdv
  - PLUGIN_CODE Cpmp
  - IS_SYNTH TRUE (categorizes as Instrument in Bitwig — user locked decision)
  - NEEDS_MIDI_INPUT TRUE
  - NEEDS_MIDI_OUTPUT TRUE
  - IS_MIDI_EFFECT FALSE (not a MIDI effect — user locked decision)
  - EDITOR_WANTS_KEYBOARD_FOCUS TRUE
  - COPY_PLUGIN_AFTER_BUILD TRUE (auto-copies VST3 to ~/.vst3/)
  - FORMATS VST3 Standalone
  - PRODUCT_NAME "ChordPumper"
  - PLUGIN_NAME "ChordPumper"
  - DESCRIPTION "Chord progression discovery instrument"
- `clap_juce_extensions_plugin(TARGET ChordPumper CLAP_ID "org.chordpumper.chordpumper" CLAP_FEATURES instrument utility)`
- `target_sources(ChordPumper PRIVATE src/PluginProcessor.cpp src/ui/PluginEditor.cpp)` — files don't exist yet, but CMake configure will succeed; build will fail (expected, Plan 01-02 creates them)
- `target_include_directories(ChordPumper PRIVATE src)`
- `target_compile_definitions(ChordPumper PUBLIC JUCE_WEB_BROWSER=0 JUCE_USE_CURL=0 JUCE_VST3_CAN_REPLACE_VST2=0 JUCE_DISPLAY_SPLASH_SCREEN=0)`
- `target_link_libraries(ChordPumper PRIVATE juce::juce_audio_processors juce::juce_audio_basics juce::juce_gui_basics juce::juce_gui_extra juce::juce_data_structures PUBLIC juce::juce_recommended_config_flags juce::juce_recommended_lto_flags juce::juce_recommended_warning_flags)`
- CLAP post-build copy command:
  ```cmake
  add_custom_command(TARGET ChordPumper_CLAP POST_BUILD
      COMMAND ${CMAKE_COMMAND} -E make_directory "$ENV{HOME}/.clap"
      COMMAND ${CMAKE_COMMAND} -E copy "$<TARGET_FILE:ChordPumper_CLAP>" "$ENV{HOME}/.clap/"
  )
  ```

Create CMakePresets.json with debug and release presets using Ninja generator (reference research "CMakePresets.json" section):
- debug preset: Ninja, binaryDir=build/debug, CMAKE_BUILD_TYPE=Debug, CMAKE_EXPORT_COMPILE_COMMANDS=ON
- release preset: Ninja, binaryDir=build/release, CMAKE_BUILD_TYPE=Release
- Build presets referencing configure presets

Run `cmake --preset debug` to verify configuration succeeds. The configure step should complete even though source files don't exist yet (CMake only checks at build time). If CMake errors on missing source files, create empty placeholder .cpp files.

Symlink compile_commands.json: `ln -sf build/debug/compile_commands.json .`
  </action>
  <verify>
Run: `cmake --preset debug` — must complete without errors (exit code 0).
Run: `ls build/debug/build.ninja` — Ninja build file must exist.
Run: `ls compile_commands.json` — symlink must exist.
Inspect CMakeLists.txt: must contain `juce_add_plugin`, `clap_juce_extensions_plugin`, `IS_SYNTH TRUE`, `NEEDS_MIDI_OUTPUT TRUE`.
  </verify>
  <done>CMake configures successfully with Ninja. All plugin format targets (VST3, CLAP, Standalone) are defined. Build presets for debug and release work.</done>
</task>

</tasks>

<verification>
1. `cmake --preset debug` exits 0
2. `ls libs/JUCE/modules/juce_audio_processors/` confirms JUCE submodule is correct
3. `ls libs/clap-juce-extensions/clap-libs/clap/include/clap/` confirms recursive submodules
4. `grep "juce_add_plugin" CMakeLists.txt` confirms plugin target exists
5. `grep "clap_juce_extensions_plugin" CMakeLists.txt` confirms CLAP integration
</verification>

<success_criteria>
- CMake configures without errors on CachyOS with Ninja generator
- JUCE 8.0.12 submodule present at libs/JUCE
- clap-juce-extensions submodule present at libs/clap-juce-extensions with recursive deps
- CMakeLists.txt declares VST3, CLAP, and Standalone format targets
- Plugin categorized as Instrument (IS_SYNTH TRUE, IS_MIDI_EFFECT FALSE)
</success_criteria>

<output>
After completion, create `.planning/phases/01-plugin-foundation/01-01-SUMMARY.md`
</output>
