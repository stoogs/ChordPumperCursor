---
phase: 01-plugin-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - src/PluginProcessor.h
  - src/PluginProcessor.cpp
  - src/ui/PluginEditor.h
  - src/ui/PluginEditor.cpp
  - src/ui/ChordPumperLookAndFeel.h
  - src/engine/.gitkeep
  - src/midi/.gitkeep
autonomous: true
requirements:
  - PLAT-01
  - PLAT-02
  - PLAT-03
  - PLAT-04

must_haves:
  truths:
    - "Build produces VST3, CLAP, and Standalone binaries from a single cmake --build"
    - "Standalone application launches and displays a 1000x600 dark-themed window"
    - "Window shows 'ChordPumper v0.1.0' text centered"
  artifacts:
    - path: "src/PluginProcessor.h"
      provides: "AudioProcessor subclass declaration"
      contains: "class ChordPumperProcessor"
    - path: "src/PluginProcessor.cpp"
      provides: "AudioProcessor implementation with stereo output bus and silence processBlock"
      contains: "BusesProperties"
    - path: "src/ui/PluginEditor.h"
      provides: "AudioProcessorEditor subclass declaration"
      contains: "class ChordPumperEditor"
    - path: "src/ui/PluginEditor.cpp"
      provides: "Editor implementation with 1000x600 window and centered text"
      contains: "setSize"
    - path: "src/ui/ChordPumperLookAndFeel.h"
      provides: "Custom dark theme LookAndFeel_V4 subclass"
      contains: "ChordPumperLookAndFeel"
  key_links:
    - from: "src/PluginProcessor.cpp"
      to: "CMakeLists.txt IS_SYNTH flag"
      via: "BusesProperties stereo output + isMidiEffect()=false must match IS_SYNTH TRUE"
      pattern: "withOutput.*stereo"
    - from: "src/PluginProcessor.cpp"
      to: "CMakeLists.txt MIDI flags"
      via: "acceptsMidi()=true and producesMidi()=true must match NEEDS_MIDI_INPUT/OUTPUT TRUE"
      pattern: "acceptsMidi.*return true"
    - from: "src/ui/PluginEditor.cpp"
      to: "src/ui/ChordPumperLookAndFeel.h"
      via: "setLookAndFeel(&lookAndFeel) in constructor, setLookAndFeel(nullptr) in destructor"
      pattern: "setLookAndFeel"
    - from: "src/PluginProcessor.cpp"
      to: "src/ui/PluginEditor.h"
      via: "createEditor() returns new ChordPumperEditor"
      pattern: "createEditor"
---

<objective>
Create the minimal plugin source files (AudioProcessor, AudioProcessorEditor, LookAndFeel) and build all three plugin formats. After this plan, ChordPumper compiles and the standalone shows a dark window with the plugin name.

Purpose: Produce the actual plugin binaries — the first time ChordPumper exists as running software.
Output: VST3, CLAP, and Standalone binaries. Standalone launches with 1000x600 dark window.
</objective>

<execution_context>
@~/.cursor/get-shit-done/workflows/execute-plan.md
@~/.cursor/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-plugin-foundation/01-RESEARCH.md
@.planning/phases/01-plugin-foundation/01-CONTEXT.md
@.planning/phases/01-plugin-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Plugin source files and directory structure</name>
  <files>src/PluginProcessor.h, src/PluginProcessor.cpp, src/ui/PluginEditor.h, src/ui/PluginEditor.cpp, src/ui/ChordPumperLookAndFeel.h, src/engine/.gitkeep, src/midi/.gitkeep</files>
  <action>
Create the modular directory structure and all source files. Everything lives in the `chordpumper` namespace per user decision.

**Directory stubs** (establish layout for future phases):
- Create `src/engine/.gitkeep` (empty — populated in Phase 2)
- Create `src/midi/.gitkeep` (empty — populated in Phase 3)

**src/PluginProcessor.h:**
- `#pragma once`
- Include `<juce_audio_processors/juce_audio_processors.h>` (direct module include, NOT juce_generate_juce_header)
- `namespace chordpumper {`
- Class `ChordPumperProcessor : public juce::AudioProcessor`
- Constructor declares `BusesProperties().withOutput("Output", juce::AudioChannelSet::stereo(), true)` — stereo output bus required because IS_SYNTH TRUE; outputs silence in Phase 1
- Override all required AudioProcessor methods:
  - `prepareToPlay`, `releaseResources`, `processBlock` (clear buffer — silence)
  - `hasEditor() = true`, `createEditor()`
  - `getName() = JucePlugin_Name`
  - `acceptsMidi() = true` (matches NEEDS_MIDI_INPUT TRUE)
  - `producesMidi() = true` (matches NEEDS_MIDI_OUTPUT TRUE)
  - `isMidiEffect() = false` (matches IS_MIDI_EFFECT FALSE — CRITICAL: mismatch causes pluginval failure)
  - `getTailLengthSeconds() = 0.0`
  - Programs: `getNumPrograms()=1`, `getCurrentProgram()=0`, stubs for set/get/change
  - State: `getStateInformation()` and `setStateInformation()` as empty stubs
- `} // namespace chordpumper`

**src/PluginProcessor.cpp:**
- Include `"PluginProcessor.h"` and `"ui/PluginEditor.h"`
- Implement all methods declared in the header
- `createEditor()` returns `new ChordPumperEditor(*this)`
- At file end, outside namespace: `juce::AudioProcessor* JUCE_CALLTYPE createPluginFilter() { return new chordpumper::ChordPumperProcessor(); }` — this is the JUCE plugin entry point

**src/ui/ChordPumperLookAndFeel.h:**
- `#pragma once`
- Include `<juce_gui_basics/juce_gui_basics.h>`
- `namespace chordpumper {`
- Free function `getChordPumperColourScheme()` returning `juce::LookAndFeel_V4::ColourScheme` with dark colors:
  - windowBackground: `0xff1e1e2e` (very dark, near-black)
  - widgetBackground: `0xff181825` (slightly darker)
  - menuBackground: `0xff2a2a3a` (subtle contrast)
  - outline: `0xff4a4a5a` (muted grey)
  - defaultText: `0xffe0e0e0` (soft white, not harsh)
  - defaultFill: `0xff6c8ebf` (muted blue accent)
  - highlightedText: `0xffffffff` (bright white)
  - highlightedFill: `0xff3a3a4a` (subtle highlight)
  - menuText: `0xffe0e0e0` (soft white)
- Class `ChordPumperLookAndFeel : public juce::LookAndFeel_V4` with constructor calling `LookAndFeel_V4(getChordPumperColourScheme())`
- `} // namespace chordpumper`

**src/ui/PluginEditor.h:**
- `#pragma once`
- Include `<juce_audio_processors/juce_audio_processors.h>` and `"ChordPumperLookAndFeel.h"`
- Forward declare `ChordPumperProcessor`
- `namespace chordpumper {`
- Class `ChordPumperEditor : public juce::AudioProcessorEditor`
- Constructor takes `ChordPumperProcessor&`
- Destructor (calls `setLookAndFeel(nullptr)` — CRITICAL for avoiding use-after-free crash on close, see research Pitfall 5)
- Override `paint(juce::Graphics&)` and `resized()`
- Private members:
  - `ChordPumperProcessor& processor`
  - `ChordPumperLookAndFeel lookAndFeel` — MUST be declared BEFORE any Component members (C++ destroys in reverse declaration order, so LookAndFeel outlives components)
- `} // namespace chordpumper`

**src/ui/PluginEditor.cpp:**
- Include `"PluginEditor.h"` and `"../PluginProcessor.h"`
- Constructor:
  - Call `AudioProcessorEditor(&p)` base
  - `setLookAndFeel(&lookAndFeel)`
  - `setSize(1000, 600)` — per user decision (large, room for future 8x4 grid)
- Destructor: `setLookAndFeel(nullptr)`
- `paint()`:
  - Fill entire bounds with `findColour(juce::ResizableWindow::backgroundColourId)` (pulls from LookAndFeel)
  - Set text colour to soft white `0xffe0e0e0`
  - Draw "ChordPumper v0.1.0" centered in the window using `juce::Font(28.0f)` — clean, professional, not flashy per user specifics
- `resized()`: empty for Phase 1 (no child components)
  </action>
  <verify>
Run: `ls src/PluginProcessor.h src/PluginProcessor.cpp src/ui/PluginEditor.h src/ui/PluginEditor.cpp src/ui/ChordPumperLookAndFeel.h src/engine/.gitkeep src/midi/.gitkeep` — all 7 files must exist.
Run: `grep "namespace chordpumper" src/PluginProcessor.h` — must match.
Run: `grep "isMidiEffect" src/PluginProcessor.cpp` — must return false.
Run: `grep "setLookAndFeel(nullptr)" src/ui/PluginEditor.cpp` — must exist (destructor safety).
Run: `grep "setSize.*1000.*600" src/ui/PluginEditor.cpp` — must match window size.
  </verify>
  <done>All plugin source files created in chordpumper namespace. PluginProcessor declares stereo output bus with MIDI flags matching CMake. PluginEditor renders 1000x600 dark window with centered "ChordPumper v0.1.0". LookAndFeel lifecycle is safe (nullptr in destructor).</done>
</task>

<task type="auto">
  <name>Task 2: Build all formats and verify artifacts</name>
  <files></files>
  <action>
Build the plugin and verify all three format binaries are produced:

1. Build:
   ```
   cmake --build build/debug
   ```
   If build fails, diagnose and fix. Common issues:
   - Missing Linux dependencies → install via `sudo pacman -S --needed alsa-lib jack2 freetype2 fontconfig libx11 libxcomposite libxcursor libxext libxinerama libxrandr libxrender mesa glu curl pkgconf`
   - Source file errors → fix until compilation succeeds
   - Linker errors → check target_link_libraries in CMakeLists.txt

2. Verify all three format artifacts exist:
   - VST3: `build/debug/ChordPumper_artefacts/VST3/ChordPumper.vst3` (directory bundle)
   - CLAP: `build/debug/ChordPumper_artefacts/CLAP/ChordPumper.clap` (single file)
   - Standalone: `build/debug/ChordPumper_artefacts/Standalone/ChordPumper` (executable)

3. Verify CLAP was copied to ~/.clap/ by post-build command:
   ```
   ls ~/.clap/ChordPumper.clap
   ```

4. Verify VST3 was auto-copied by COPY_PLUGIN_AFTER_BUILD:
   ```
   ls ~/.vst3/ChordPumper.vst3
   ```

5. Symlink compile_commands.json for clangd IDE support:
   ```
   ln -sf build/debug/compile_commands.json .
   ```

6. Launch standalone briefly to verify it runs:
   ```
   timeout 3 ./build/debug/ChordPumper_artefacts/Standalone/ChordPumper 2>&1 || true
   ```
   A non-zero exit from timeout is expected (it kills after 3s). The test passes if the process starts without immediate crash. On headless systems, this may fail — that's acceptable; the checkpoint in Plan 01-03 will verify visually.
  </action>
  <verify>
Run: `ls build/debug/ChordPumper_artefacts/VST3/ChordPumper.vst3` — must exist.
Run: `ls build/debug/ChordPumper_artefacts/CLAP/ChordPumper.clap` — must exist.
Run: `ls build/debug/ChordPumper_artefacts/Standalone/ChordPumper` — must exist and be executable.
Run: `ls ~/.vst3/ChordPumper.vst3` — must exist (auto-copied).
Run: `ls ~/.clap/ChordPumper.clap` — must exist (post-build copied).
Run: `file build/debug/ChordPumper_artefacts/Standalone/ChordPumper` — must show ELF executable, x86-64.
  </verify>
  <done>All three plugin formats (VST3, CLAP, Standalone) build successfully from a single CMake configuration. Binaries are installed to ~/.vst3/ and ~/.clap/ for host discovery. Standalone is an x86_64 Linux ELF executable.</done>
</task>

</tasks>

<verification>
1. `cmake --build build/debug` exits 0 (clean build)
2. Three format binaries exist in build/debug/ChordPumper_artefacts/
3. VST3 installed to ~/.vst3/ChordPumper.vst3
4. CLAP installed to ~/.clap/ChordPumper.clap
5. Standalone is executable ELF binary
6. Source files use chordpumper namespace throughout
7. MIDI flags in C++ match CMake configuration (acceptsMidi=true, producesMidi=true, isMidiEffect=false)
</verification>

<success_criteria>
- `cmake --build build/debug` completes without errors
- All three format artifacts exist (VST3 bundle, CLAP file, Standalone executable)
- VST3 and CLAP installed to standard Linux plugin paths
- Source files follow modular layout: src/ root for Processor, src/ui/ for Editor/LookAndFeel
- Plugin is categorized as Instrument with MIDI I/O (matching Phase 1 decisions)
</success_criteria>

<output>
After completion, create `.planning/phases/01-plugin-foundation/01-02-SUMMARY.md`
</output>
