---
phase: 09-chord-depth-ui-polish
plan: 02
type: execute
wave: 2
depends_on:
  - 09-01
files_modified:
  - src/ui/PadComponent.h
  - src/ui/PadComponent.cpp
autonomous: true
requirements:
  - DEPTH-01
  - DEPTH-02

must_haves:
  truths:
    - "Major, Minor, Maj7, Min7, Dom7 pads are visually divided into 4 quadrants with thin separator lines"
    - "Each quadrant shows a short label (e.g. 'maj7', 'm9') at small font"
    - "Clicking/pressing a quadrant plays the corresponding extension chord, not always the base chord"
    - "Pads without sub-variations (Dim, Aug, Dim7, HalfDim7, 9th/11th/13th types) render as before"
    - "All pads show a visibly thicker border (3px) at rest"
    - "Hovering a pad produces a multi-ring glow effect in the pad's accent colour"
  artifacts:
    - path: "src/ui/PadComponent.h"
      provides: "hasSubVariations, subChords[4], pressedQuadrant fields; quadrantAt() helper declaration"
      contains: "hasSubVariations"
    - path: "src/ui/PadComponent.cpp"
      provides: "quadrantAt(), quadrant label paint, glow rings in paint(), updated mouseDown/mouseUp"
      contains: "quadrantAt"
  key_links:
    - from: "src/ui/PadComponent.cpp paint()"
      to: "hasSubVariations field"
      via: "conditional quadrant rendering branch"
      pattern: "if.*hasSubVariations"
    - from: "src/ui/PadComponent.cpp mouseDown()"
      to: "quadrantAt() + subChords[]"
      via: "pressedQuadrant set on mouseDown, used in onPressStart/onPressEnd"
      pattern: "pressedQuadrant"
    - from: "src/ui/GridPanel.cpp (or wherever pads are configured)"
      to: "PadComponent::hasSubVariations and subChords"
      via: "setChord() caller sets sub-variations for qualifying types"
      pattern: "hasSubVariations|subChords"
---

<objective>
Add two related visual features to PadComponent: quadrant sub-variation display for extension-eligible chord types, and bolder/glowing borders on hover.

Purpose: These features live entirely within PadComponent and its callers. The quadrant split lets users choose 7th/9th/11th/13th extensions of a base chord by clicking the matching quarter of the pad. The glow effect makes hover feedback more expressive.

Output: Updated PadComponent.h with new fields and method; updated PadComponent.cpp with quadrant layout rendering, glow rings, and quadrant-aware press handling; callers updated to populate subChords where appropriate.
</objective>

<execution_context>
@/home/stoo/.claude/get-shit-done/workflows/execute-plan.md
@/home/stoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-chord-depth-ui-polish/09-01-SUMMARY.md
@src/ui/PadComponent.h
@src/ui/PadComponent.cpp
@src/ui/ChordPumperLookAndFeel.h
@src/engine/ChordType.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add quadrant fields to PadComponent.h and update PadComponent.cpp</name>
  <files>
    src/ui/PadComponent.h
    src/ui/PadComponent.cpp
  </files>
  <action>
**PadComponent.h — add to private section:**
```cpp
bool hasSubVariations = false;
std::array<Chord, 4> subChords{};   // TL=0, TR=1, BL=2, BR=3
int pressedQuadrant = -1;           // -1 = whole pad, 0-3 = quadrant index
int quadrantAt(juce::Point<int> pos) const;
```
Also add a public setter:
```cpp
void setSubVariations(bool enabled, const std::array<Chord,4>& chords);
```

**PadComponent.cpp — implement quadrantAt():**
```cpp
int PadComponent::quadrantAt(juce::Point<int> pos) const
{
    if (!hasSubVariations) return -1;
    bool right  = pos.getX() >= getWidth()  / 2;
    bool bottom = pos.getY() >= getHeight() / 2;
    return (bottom ? 2 : 0) + (right ? 1 : 0);  // TL=0, TR=1, BL=2, BR=3
}
```

**PadComponent.cpp — implement setSubVariations():**
```cpp
void PadComponent::setSubVariations(bool enabled, const std::array<Chord,4>& chords)
{
    hasSubVariations = enabled;
    subChords = chords;
    repaint();
}
```

**PadComponent.cpp — update paint() for quadrant rendering:**

After the rounded rect fill and BEFORE drawing the border, add quadrant separators when hasSubVariations:
```cpp
if (hasSubVariations)
{
    g.setColour(juce::Colour(0x22ffffff));
    // Vertical centre line
    g.drawLine(bounds.getCentreX(), bounds.getY() + 4.0f,
               bounds.getCentreX(), bounds.getBottom() - 4.0f, 1.0f);
    // Horizontal centre line
    g.drawLine(bounds.getX() + 4.0f, bounds.getCentreY(),
               bounds.getRight() - 4.0f, bounds.getCentreY(), 1.0f);
}
```

After the separator lines, draw quadrant labels when hasSubVariations (instead of the normal chord name drawing):
```cpp
if (hasSubVariations)
{
    g.setFont(juce::Font(juce::FontOptions(7.5f)));
    constexpr juce::uint32 quadrantColour = 0xffcccccc;
    g.setColour(juce::Colour(quadrantColour));
    auto w = getWidth() / 2;
    auto h = getHeight() / 2;
    // TL quadrant (index 0)
    g.drawText(juce::String(subChords[0].name()),
               juce::Rectangle<int>(0, 0, w, h), juce::Justification::centred);
    // TR quadrant (index 1)
    g.drawText(juce::String(subChords[1].name()),
               juce::Rectangle<int>(w, 0, w, h), juce::Justification::centred);
    // BL quadrant (index 2)
    g.drawText(juce::String(subChords[2].name()),
               juce::Rectangle<int>(0, h, w, h), juce::Justification::centred);
    // BR quadrant (index 3)
    g.drawText(juce::String(subChords[3].name()),
               juce::Rectangle<int>(w, h, w, h), juce::Justification::centred);
}
else
{
    // existing chord name + Roman numeral rendering (unchanged)
}
```

**PadComponent.cpp — update mouseDown() to track pressedQuadrant:**
After `isDragInProgress = false;`, add:
```cpp
pressedQuadrant = quadrantAt(event.getPosition());
```

When invoking onPressStart, pass the correct chord:
```cpp
const Chord& activeChord = (hasSubVariations && pressedQuadrant >= 0)
    ? subChords[static_cast<size_t>(pressedQuadrant)]
    : chord;
if (onPressStart)
    onPressStart(activeChord);
```

**PadComponent.cpp — update mouseUp() similarly:**
Replace the `onPressEnd(chord)` and `onClick(chord)` calls with:
```cpp
const Chord& activeChord = (hasSubVariations && pressedQuadrant >= 0)
    ? subChords[static_cast<size_t>(pressedQuadrant)]
    : chord;
if (!isDragInProgress)
{
    if (onPressEnd) onPressEnd(activeChord);
    if (event.getDistanceFromDragStart() < 6 && onClick) onClick(activeChord);
}
isDragInProgress = false;
pressedQuadrant = -1;
```

Also reset pressedQuadrant in mouseExit():
```cpp
pressedQuadrant = -1;
```
  </action>
  <verify>cmake --build /home/stoo/code/GSD/Plugins/ChordPumperCursor/build-release --config Release -j$(nproc) 2>&1 | tail -5</verify>
  <done>Build succeeds. PadComponent.h has hasSubVariations, subChords, pressedQuadrant, quadrantAt(), setSubVariations(). mouseDown/mouseUp/mouseExit handle quadrant selection correctly.</done>
</task>

<task type="auto">
  <name>Task 2: Bolder borders + glow effect, and wire sub-variations in GridPanel</name>
  <files>
    src/ui/PadComponent.cpp
    src/ui/GridPanel.cpp
  </files>
  <action>
**PadComponent.cpp — border thickness and hover glow:**

In paint(), find the existing border draw line:
```cpp
g.drawRoundedRectangle(bounds, cornerSize, 1.5f);
```
Replace it with:
- Normal border at 3.0f thickness (was 1.5f)
- When isHovered, draw 4 concentric glow rings BEFORE the solid border:

```cpp
// Glow rings (hover only) — painted BEFORE the solid border
if (isHovered)
{
    g.setColour(accentColour.withAlpha(0.07f));
    g.drawRoundedRectangle(bounds.reduced(0.5f), cornerSize, 9.0f);
    g.setColour(accentColour.withAlpha(0.13f));
    g.drawRoundedRectangle(bounds.reduced(0.5f), cornerSize, 6.0f);
    g.setColour(accentColour.withAlpha(0.25f));
    g.drawRoundedRectangle(bounds.reduced(0.5f), cornerSize, 4.0f);
}
// Solid border — always drawn, 3px
g.setColour(accentColour.withAlpha(accentAlpha));
g.drawRoundedRectangle(bounds.reduced(0.5f), cornerSize, 3.0f);
```

NOTE: Do NOT use juce::GlowEffect — PadComponent fills opaquely so GlowEffect alpha channel has nothing to blur. Paint rings only.

**GridPanel.cpp — populate sub-variations when setChord is called:**

Find where pads are assigned chords (the morphTo() or equivalent loop that calls pad.setChord()). After each setChord() call, determine whether the chord type qualifies for sub-variations and call setSubVariations(). Qualifying base types and their quadrant mappings:

```cpp
// After pad.setChord(chord):
auto makeSubChords = [](PitchClass root, ChordType tl, ChordType tr, ChordType bl, ChordType br)
    -> std::array<Chord, 4>
{
    return { Chord{root, tl}, Chord{root, tr}, Chord{root, bl}, Chord{root, br} };
};

switch (chord.type)
{
    case ChordType::Major:
        pad.setSubVariations(true, makeSubChords(chord.root,
            ChordType::Major, ChordType::Maj7, ChordType::Maj9, ChordType::Maj13));
        break;
    case ChordType::Minor:
        pad.setSubVariations(true, makeSubChords(chord.root,
            ChordType::Minor, ChordType::Min7, ChordType::Min9, ChordType::Min11));
        break;
    case ChordType::Maj7:
        pad.setSubVariations(true, makeSubChords(chord.root,
            ChordType::Maj7, ChordType::Maj9, ChordType::Maj11, ChordType::Maj13));
        break;
    case ChordType::Min7:
        pad.setSubVariations(true, makeSubChords(chord.root,
            ChordType::Min7, ChordType::Min9, ChordType::Min11, ChordType::Min13));
        break;
    case ChordType::Dom7:
        pad.setSubVariations(true, makeSubChords(chord.root,
            ChordType::Dom7, ChordType::Dom9, ChordType::Dom11, ChordType::Dom13));
        break;
    default:
        pad.setSubVariations(false, {});
        break;
}
```

Inspect GridPanel.cpp to find the exact location — it may be in morphTo(), refreshFromState(), or a helper loop. Apply the wiring wherever setChord() is called on a pad.

Build and verify. Fix any compilation errors before marking complete.
  </action>
  <verify>cmake --build /home/stoo/code/GSD/Plugins/ChordPumperCursor/build-release --config Release -j$(nproc) 2>&1 | tail -5</verify>
  <done>
Release build succeeds. Plugin installed to ~/.vst3 and ~/.clap.
In the running plugin:
- Any Major/Minor/Maj7/Min7/Dom7 pad shows 4 labelled quadrants with faint dividers
- Clicking each quadrant fires onPressStart/onPressEnd with the correct sub-chord
- All pads have visibly thicker 3px borders
- Moving mouse over any pad shows concentric glow rings in the pad's accent colour
- Pads for Dim/Aug/Dim7/HalfDim7/extension types still render normally (no quadrant split)
  </done>
</task>

</tasks>

<verification>
1. Build is clean: no errors or warnings
2. grep confirms glow rings: `grep "withAlpha(0.07f)" src/ui/PadComponent.cpp`
3. grep confirms 3.0f border: `grep "cornerSize, 3.0f" src/ui/PadComponent.cpp`
4. grep confirms quadrant separator: `grep "quadrantAt\|hasSubVariations" src/ui/PadComponent.cpp | wc -l` returns 5+
5. grep confirms sub-variation wiring: `grep "setSubVariations" src/ui/GridPanel.cpp`
</verification>

<success_criteria>
- Pads for Major/Minor/Maj7/Min7/Dom7 types show 4 labelled quadrants
- Pressing a quadrant fires the correct extension chord (verifiable by listening: pressing TR on a C Major pad sends Cmaj7 notes)
- All pads have 3px borders (was 1.5px)
- Hovering shows accent-coloured concentric glow rings
- Non-qualifying pad types render unchanged
- Full release build installs plugin
</success_criteria>

<output>
After completion, create `.planning/phases/09-chord-depth-ui-polish/09-02-SUMMARY.md`
</output>
