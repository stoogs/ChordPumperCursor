---
phase: 09-chord-depth-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/engine/ChordType.h
  - src/engine/PitchClassSet.h
  - src/ui/ChordPumperLookAndFeel.h
  - src/engine/MorphEngine.cpp
autonomous: true
requirements:
  - DEPTH-01
  - DEPTH-02
  - DEPTH-03

must_haves:
  truths:
    - "All 18 chord types (9 existing + 9 extension types) can be constructed and named"
    - "kAllChords contains 216 chords (12 roots × 18 types)"
    - "noteCount() returns 3 for triads, 4 for 7ths, 5 for 9ths, 6 for 11ths/13ths"
    - "kIntervals array has 6 slots per chord type (unused slots are -1)"
    - "MorphEngine iterates all 216 chords without assertion failure or out-of-bounds"
    - "accentForType() handles all 18 types without undefined behaviour"
  artifacts:
    - path: "src/engine/ChordType.h"
      provides: "ChordType enum with 18 values, kIntervals[18][6], kChordSuffix[18], noteCount()"
      contains: "Maj9, Maj11, Maj13, Min9, Min11, Min13, Dom9, Dom11, Dom13"
    - path: "src/engine/PitchClassSet.h"
      provides: "allChords() returning std::array<Chord, 216> and kAllChords"
      contains: "std::array<Chord, 216>"
    - path: "src/ui/ChordPumperLookAndFeel.h"
      provides: "accentForType() with 18-entry array"
      contains: "accents[18]"
    - path: "src/engine/MorphEngine.cpp"
      provides: "Updated reserve() for expanded pool"
      contains: "reserve(216)"
  key_links:
    - from: "src/engine/Chord.cpp"
      to: "src/engine/ChordType.h"
      via: "kIntervals and kChordSuffix lookups by static_cast<int>(type)"
      pattern: "kIntervals\\[static_cast<int>"
    - from: "src/engine/PitchClassSet.h"
      to: "src/engine/ChordType.h"
      via: "noteCount() and kIntervals accessed per chord during allChords()"
      pattern: "kAllChords"
    - from: "src/engine/MorphEngine.cpp"
      to: "src/engine/PitchClassSet.h"
      via: "iterates kAllChords in morphTo()"
      pattern: "for.*kAllChords"
---

<objective>
Expand the chord type system from 9 types to 18 types by adding 9th, 11th, and 13th extensions for Major, Minor, and Dominant families.

Purpose: This is the foundation for quadrant sub-variations on pads. All interval data, naming, and colour lookup must exist before PadComponent can present extension choices. MorphEngine also needs updating so the expanded chord pool doesn't overflow its reservation.

Output: ChordType.h with 18 enum values and updated lookup tables; PitchClassSet.h with allChords() returning 216 chords; ChordPumperLookAndFeel.h with 18-entry accent array; MorphEngine.cpp with corrected reserve().
</objective>

<execution_context>
@/home/stoo/.claude/get-shit-done/workflows/execute-plan.md
@/home/stoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/engine/ChordType.h
@src/engine/PitchClassSet.h
@src/engine/Chord.cpp
@src/ui/ChordPumperLookAndFeel.h
@src/engine/MorphEngine.cpp
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand ChordType.h to 18 types with 6-slot interval tables</name>
  <files>src/engine/ChordType.h</files>
  <action>
Replace the entire file contents. Add 9 new enum values after HalfDim7:
  Maj9 = 9, Maj11 = 10, Maj13 = 11,
  Min9 = 12, Min11 = 13, Min13 = 14,
  Dom9 = 15, Dom11 = 16, Dom13 = 17

Replace kIntervals from std::array<std::array<int,4>,9> to std::array<std::array<int,6>,18>. All existing 9 rows gain two trailing -1 slots. New 9 rows:
  {0,4,7,11,14,-1},  // Maj9
  {0,4,7,11,14,17},  // Maj11  (17 = major 11th = perfect 11th)
  {0,4,7,11,14,21},  // Maj13  (21 = major 13th)
  {0,3,7,10,14,-1},  // Min9
  {0,3,7,10,14,17},  // Min11
  {0,3,7,10,14,21},  // Min13
  {0,4,7,10,14,-1},  // Dom9
  {0,4,7,10,14,17},  // Dom11
  {0,4,7,10,14,21},  // Dom13

Replace kChordSuffix from size 9 to 18, appending:
  "maj9","maj11","maj13","m9","m11","m13","9","11","13"

Replace noteCount() function:
  int t = static_cast<int>(type);
  if (t < 4)  return 3;   // triads
  if (t < 9)  return 4;   // 7ths
  if (t == 9 || t == 12 || t == 15) return 5;  // 9ths
  return 6;  // 11ths and 13ths

IMPORTANT: Chord.cpp uses kIntervals with kIntervals[static_cast<int>(type)] and iterates up to noteCount() — the 6-slot array is backward-compatible because noteCount() still returns 3 or 4 for existing types, so the extra -1 slots are never read.
  </action>
  <verify>cmake --build /home/stoo/code/GSD/Plugins/ChordPumperCursor/build-release --config Release -j$(nproc) 2>&1 | tail -5</verify>
  <done>Build succeeds with no errors. No array size mismatch or out-of-bounds compiler warnings on ChordType.h.</done>
</task>

<task type="auto">
  <name>Task 2: Update PitchClassSet.h, ChordPumperLookAndFeel.h, and MorphEngine.cpp for 18 types</name>
  <files>
    src/engine/PitchClassSet.h
    src/ui/ChordPumperLookAndFeel.h
    src/engine/MorphEngine.cpp
  </files>
  <action>
**PitchClassSet.h:** Change allChords() return type from std::array<Chord,108> to std::array<Chord,216>. Change the internal constexpr types array from ChordType[9] to ChordType[18] and add the 9 new enum values in order: Maj9, Maj11, Maj13, Min9, Min11, Min13, Dom9, Dom11, Dom13. Change the result array size from 108 to 216 and the kAllChords constexpr auto accordingly.

**ChordPumperLookAndFeel.h:** In accentForType(), expand the accents[] array from 9 to 18 entries. Append 9 colours following their family colours:
  - Maj9  → 0xff4db8ff  (brighter blue, lighter than maj7Accent 0xff6baed6)
  - Maj11 → 0xff80ccff  (even lighter blue)
  - Maj13 → 0xffaadeff  (palest blue)
  - Min9  → 0xffc4abff  (lighter purple, lighter than min7Accent 0xffb39ddb)
  - Min11 → 0xffd5c2ff  (even lighter purple)
  - Min13 → 0xffe8d8ff  (palest purple)
  - Dom9  → 0xff7dd6eb  (lighter teal, lighter than dom7Accent 0xff5bc0de)
  - Dom11 → 0xff9de3f2  (even lighter teal)
  - Dom13 → 0xffbdeef8  (palest teal)

**MorphEngine.cpp:** Change `all.reserve(108)` to `all.reserve(216)` on the line found at approximately line 90.

After all three file changes, do a full release build and fix any compilation errors.
  </action>
  <verify>cmake --build /home/stoo/code/GSD/Plugins/ChordPumperCursor/build-release --config Release -j$(nproc) 2>&1 | tail -10</verify>
  <done>Full release build succeeds. Plugin installs to ~/.vst3 and ~/.clap via post-build CMake steps. All 216 chord combinations reachable via kAllChords.</done>
</task>

</tasks>

<verification>
After both tasks:
1. Build produces no errors or warnings about array bounds
2. grep confirms: `grep -c "Maj9\|Min9\|Dom9" src/engine/ChordType.h` returns 3+
3. grep confirms: `grep "array<Chord, 216>" src/engine/PitchClassSet.h` matches
4. grep confirms: `grep "accents\[18\]\|accents\[\]" src/ui/ChordPumperLookAndFeel.h` — array has exactly 18 entries (count commas: 17 commas)
5. grep confirms: `grep "reserve(216)" src/engine/MorphEngine.cpp` matches
</verification>

<success_criteria>
- 18-value ChordType enum compiles with no warnings
- kIntervals is [18][6], kChordSuffix is [18], noteCount() handles all ranges
- allChords() returns 216 chords, kAllChords constexpr populated
- accentForType() array has 18 entries, no undefined behaviour on new types
- MorphEngine reserve(216) prevents unnecessary reallocation
- Release build succeeds and installs plugin
</success_criteria>

<output>
After completion, create `.planning/phases/09-chord-depth-ui-polish/09-01-SUMMARY.md`
</output>
