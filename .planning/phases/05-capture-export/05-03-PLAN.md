---
phase: 05-capture-export
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ui/ProgressionStrip.h
  - src/ui/ProgressionStrip.cpp
  - src/ui/PluginEditor.h
  - src/ui/PluginEditor.cpp
  - src/ui/GridPanel.h
  - src/ui/GridPanel.cpp
  - CMakeLists.txt
autonomous: true
requirements: [CAPT-02, CAPT-03]

must_haves:
  truths:
    - "A horizontal strip below the grid shows the sequence of chords the user has clicked"
    - "Up to 8 chords are displayed in the progression strip"
    - "When 8 chords are reached, the oldest chord is dropped (FIFO) to make room for new ones"
    - "User can click a Clear button to reset the progression strip"
    - "The strip updates immediately when a pad is clicked"
  artifacts:
    - path: "src/ui/ProgressionStrip.h"
      provides: "ProgressionStrip component with addChord(), clear(), paint()"
      contains: "class ProgressionStrip"
    - path: "src/ui/ProgressionStrip.cpp"
      provides: "Rendering of chord slots and clear button"
      contains: "addChord"
    - path: "src/ui/PluginEditor.h"
      provides: "ProgressionStrip member added to editor"
      contains: "ProgressionStrip"
    - path: "src/ui/PluginEditor.cpp"
      provides: "Layout includes progression strip below grid"
      contains: "progressionStrip"
  key_links:
    - from: "src/ui/GridPanel.cpp"
      to: "src/ui/ProgressionStrip.h"
      via: "onChordPlayed callback triggers addChord"
      pattern: "onChordPlayed"
    - from: "src/ui/PluginEditor.cpp"
      to: "src/ui/ProgressionStrip.h"
      via: "PluginEditor owns and lays out ProgressionStrip"
      pattern: "progressionStrip"
    - from: "src/ui/PluginEditor.cpp"
      to: "src/ui/GridPanel.h"
      via: "Wires gridPanel.onChordPlayed to progressionStrip.addChord"
      pattern: "onChordPlayed"
---

<objective>
Build the ProgressionStrip component — a horizontal strip displaying up to 8 chords the user has explored, with a clear button to start a new sequence. Wire it into the existing GridPanel → PluginEditor layout.

Purpose: The progression strip makes the user's exploration visible and reviewable. It transforms ephemeral pad clicks into a tangible chord sequence — the precursor to full progression export.
Output: ProgressionStrip component, wired to pad clicks, with clear functionality, rendered below the grid.
</objective>

<execution_context>
@~/.cursor/get-shit-done/workflows/execute-plan.md
@~/.cursor/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/ui/PluginEditor.h
@src/ui/PluginEditor.cpp
@src/ui/GridPanel.h
@src/ui/GridPanel.cpp
@src/ui/PadComponent.h
@src/ui/ChordPumperLookAndFeel.h
@src/engine/Chord.h
@CMakeLists.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProgressionStrip component</name>
  <files>src/ui/ProgressionStrip.h, src/ui/ProgressionStrip.cpp, CMakeLists.txt</files>
  <action>
    Create ProgressionStrip as a juce::Component in the chordpumper namespace.

    **Data model:**
    - `std::vector<Chord> chords` capped at `kMaxChords = 8`
    - `addChord(const Chord& chord)`: appends chord; if size >= 8, erase front (FIFO)
    - `clear()`: empties the vector, triggers repaint
    - `getChords() const -> const std::vector<Chord>&`
    - `isEmpty() const -> bool`

    **Visual layout (paint + resized):**
    - Total height: 50px (set by parent layout)
    - 8 equal-width chord slots rendered left-to-right, with 4px gaps
    - Reserve 60px on the right for a "Clear" button (juce::TextButton member)
    - Filled slots: dark background (use PadColours scheme from ChordPumperLookAndFeel.h — e.g., `0xff2a2a3a`), chord name centered in white text, rounded corners (4px)
    - Empty slots: subtle outline only (1px border, `0xff3a3a4a`), no fill
    - Use `juce::Font(juce::FontOptions(13.0f))` for chord names (NOT the deprecated float constructor)

    **Clear button:**
    - juce::TextButton member, text "Clear", styled to match plugin look
    - onClick calls `clear()` then `repaint()`
    - Disable (setEnabled(false)) when strip is empty, enable when non-empty

    **CMake:** Add `src/ui/ProgressionStrip.cpp` to ChordPumper target_sources.
  </action>
  <verify>
    `cmake --build build` succeeds. ProgressionStrip.h declares addChord, clear, paint, resized. ProgressionStrip.cpp implements rendering with 8 slots and clear button.
  </verify>
  <done>ProgressionStrip component builds cleanly with chord slot rendering and clear button.</done>
</task>

<task type="auto">
  <name>Task 2: Wire ProgressionStrip into GridPanel and PluginEditor</name>
  <files>src/ui/GridPanel.h, src/ui/GridPanel.cpp, src/ui/PluginEditor.h, src/ui/PluginEditor.cpp</files>
  <action>
    **GridPanel — add chord-played callback:**
    - Add public member: `std::function<void(const Chord&)> onChordPlayed`
    - In `padClicked()`, after the existing morph/MIDI logic, call `if (onChordPlayed) onChordPlayed(chord);`
    - This is a simple addition — do NOT change existing padClicked behavior (MIDI trigger, voice leading, morph, grid update all remain)

    **PluginEditor — own and layout ProgressionStrip:**
    - Add `#include "ProgressionStrip.h"` to PluginEditor.h
    - Add member: `ProgressionStrip progressionStrip;`
    - In constructor: `addAndMakeVisible(progressionStrip);`
    - Wire callback: `gridPanel.onChordPlayed = [this](const Chord& c) { progressionStrip.addChord(c); };`
    - Change `setSize(1000, 650)` (was 600) to accommodate the strip

    **PluginEditor::resized() — new layout:**
    ```
    auto area = getLocalBounds().reduced(10);
    area.removeFromTop(40);                    // title header
    auto stripArea = area.removeFromBottom(50); // progression strip
    area.removeFromBottom(6);                   // gap between grid and strip
    gridPanel.setBounds(area);                  // remaining = grid
    progressionStrip.setBounds(stripArea);
    ```

    This gives: 40px title, ~494px grid, 6px gap, 50px strip, 10px padding = 650px total.
  </action>
  <verify>
    `cmake --build build` succeeds. Load plugin in standalone — click pads and verify chord names appear in the strip below the grid. Click 9+ pads and verify oldest drops off. Click Clear and verify strip empties.
  </verify>
  <done>Clicking any pad adds its chord name to the progression strip. Strip shows up to 8 chords with FIFO overflow. Clear button resets the strip. Layout is visually balanced.</done>
</task>

</tasks>

<verification>
```bash
cmake --build build --target ChordPumper
```
Build succeeds. Manual check in Standalone:
1. Launch ChordPumper Standalone
2. Click pads — chord names appear in strip below grid
3. Click 8+ pads — oldest chord drops off, newest appears at end
4. Click Clear — strip empties, Clear button disables
5. Click another pad — strip shows one chord, Clear button enables
</verification>

<success_criteria>
- ProgressionStrip renders 8 chord slots horizontally below the grid
- Clicking pads populates the strip in order
- FIFO overflow drops the oldest chord when 8 are reached
- Clear button empties the strip
- Plugin window is 1000x650 with balanced layout
- All existing functionality (grid, morph, MIDI) unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/05-capture-export/05-03-SUMMARY.md`
</output>
